---
description: "PrincÃ­pios DRY e KISS para cÃ³digo sustentÃ¡vel"
globs: ["src/**/*", "app/**/*", "domain/**/*"]
alwaysApply: true
---

## Objetivo
Evitar duplicaÃ§Ã£o de lÃ³gica e manter o cÃ³digo simples e legÃ­vel.

## ğŸš€ Quick Reference

### **PrincÃ­pios:**
- **DRY**: Don't Repeat Yourself - Evite duplicaÃ§Ã£o
- **KISS**: Keep It Simple, Stupid - Mantenha simples
- **YAGNI**: You Aren't Gonna Need It - NÃ£o implemente antes de precisar

### **Quando Aplicar:**
- âœ… **DRY**: LÃ³gica duplicada em 3+ lugares
- âœ… **KISS**: CÃ³digo difÃ­cil de entender
- âœ… **YAGNI**: Funcionalidades "que podem ser Ãºteis"

### **Conflitos Comuns:**
- **DRY vs KISS**: AbstraÃ§Ã£o excessiva vs Simplicidade
- **DRY vs YAGNI**: ReutilizaÃ§Ã£o vs Necessidade real

---

## 1. DRY â€” Don't Repeat Yourself
NÃ£o repita lÃ³gica em diferentes lugares.

âœ… Correto:
```python
def calculate_tax(amount: Decimal, rate: Decimal) -> Decimal:
    """Calcula imposto sobre um valor."""
    return amount * rate

def calculate_vat(amount: Decimal) -> Decimal:
    return calculate_tax(amount, Decimal("0.23"))

def calculate_service_tax(amount: Decimal) -> Decimal:
    return calculate_tax(amount, Decimal("0.23"))
```

âŒ Errado:
```python
def calculate_vat(amount: Decimal) -> Decimal:
    return amount * Decimal("0.23")

def calculate_service_tax(amount: Decimal) -> Decimal:
    return amount * Decimal("0.23")

def calculate_income_tax(amount: Decimal) -> Decimal:
    return amount * Decimal("0.15")
```

### **Exemplo Complexo - Parsing de Valores:**
```python
# âœ… CORRETO - LÃ³gica centralizada
class AmountParser:
    @staticmethod
    def parse_amount(value: str) -> Decimal:
        """Parse centralizado para todos os tipos de valor."""
        cleaned = re.sub(r'[^\d.,+-]', '', str(value))
        if ',' in cleaned and '.' in cleaned:
            cleaned = cleaned.replace('.', '').replace(',', '.')
        elif ',' in cleaned:
            cleaned = cleaned.replace(',', '.')
        return Decimal(cleaned)

# âŒ ERRADO - LÃ³gica duplicada
def parse_transaction_amount(value: str) -> Decimal:
    cleaned = re.sub(r'[^\d.,+-]', '', str(value))
    if ',' in cleaned and '.' in cleaned:
        cleaned = cleaned.replace('.', '').replace(',', '.')
    elif ',' in cleaned:
        cleaned = cleaned.replace(',', '.')
    return Decimal(cleaned)

def parse_balance_amount(value: str) -> Decimal:
    cleaned = re.sub(r'[^\d.,+-]', '', str(value))
    if ',' in cleaned and '.' in cleaned:
        cleaned = cleaned.replace('.', '').replace(',', '.')
    elif ',' in cleaned:
        cleaned = cleaned.replace(',', '.')
    return Decimal(cleaned)
```

---

## 2. KISS â€” Keep It Simple, Stupid
Prefira soluÃ§Ãµes simples e legÃ­veis.

âœ… Correto:
```python
if user.is_admin:
    grant_access()
```

âŒ Errado:
```python
if user.role == "admin" or user.role == "administrator" or user.role_code == 999:
    grant_access()
```

---

## 3. YAGNI â€” You Arenâ€™t Gonna Need It
NÃ£o implemente funcionalidades antes de precisar.

âœ… Correto:
- Implementar apenas mÃ©todos necessÃ¡rios agora.

âŒ Errado:
- Criar classes genÃ©ricas para cenÃ¡rios que talvez nunca aconteÃ§am.

---

## âš–ï¸ Resolvendo Conflitos

### **DRY vs KISS - Quando Abstrair?**

#### **âœ… Abstrair (DRY):**
```python
# LÃ³gica duplicada em 3+ lugares
class BaseStatementReader:
    def _parse_amount(self, value: str) -> Decimal:
        # LÃ³gica comum de parsing
        pass
```

#### **âŒ NÃ£o Abstrair (KISS):**
```python
# LÃ³gica similar mas com contextos diferentes
def parse_transaction_amount(value: str) -> Decimal:
    # Parsing especÃ­fico para transaÃ§Ãµes
    pass

def parse_balance_amount(value: str) -> Decimal:
    # Parsing especÃ­fico para saldos
    pass
```

### **DRY vs YAGNI - Quando Reutilizar?**

#### **âœ… Reutilizar (DRY):**
- LÃ³gica jÃ¡ duplicada em 3+ lugares
- Funcionalidade estÃ¡vel e bem testada
- MudanÃ§as futuras sÃ£o provÃ¡veis

#### **âŒ NÃ£o Reutilizar (YAGNI):**
- LÃ³gica similar mas contextos diferentes
- Funcionalidade ainda em evoluÃ§Ã£o
- MudanÃ§as futuras sÃ£o incertas

### **DecisÃ£o: DRY, KISS ou YAGNI?**

#### **Use DRY quando:**
- âœ… LÃ³gica idÃªntica em 3+ lugares
- âœ… MudanÃ§as precisam ser sincronizadas
- âœ… Funcionalidade estÃ¡ estÃ¡vel

#### **Use KISS quando:**
- âœ… CÃ³digo estÃ¡ difÃ­cil de entender
- âœ… AbstraÃ§Ã£o nÃ£o agrega valor
- âœ… Simplicidade Ã© mais importante

#### **Use YAGNI quando:**
- âœ… Funcionalidade nÃ£o Ã© necessÃ¡ria agora
- âœ… Requisitos futuros sÃ£o incertos
- âœ… CÃ³digo pode ser refatorado depois

### **MÃ©tricas de Qualidade:**
- **DRY**: < 5% de cÃ³digo duplicado
- **KISS**: Complexidade ciclomÃ¡tica < 10
- **YAGNI**: < 20% de cÃ³digo nÃ£o utilizado

### **Ferramentas de DetecÃ§Ã£o:**
```bash
# Detectar duplicaÃ§Ã£o
duplo src/ --html duplo-report.html

# Medir complexidade
radon cc src/ --min B

# Encontrar cÃ³digo nÃ£o utilizado
vulture src/ --min-confidence 60
```
